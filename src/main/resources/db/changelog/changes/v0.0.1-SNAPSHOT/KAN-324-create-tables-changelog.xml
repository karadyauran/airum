<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

<!--    <constraints foreignKeyName="order_id" references="credit_orders(id)"
                             unique="true" nullable="false"/>-->

    <!-- create tables -->
    <changeSet author="karadyauran" id="create users table">
        <preConditions onFail="CONTINUE" onFailMessage="Table users already exists">
            <not>
                <tableExists tableName="users"/>
            </not>
        </preConditions>
        <createTable tableName="users">
            <column name="u_user_id" type="uuid">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="u_username" type="varchar(100)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="u_name" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="u_surname" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="u_email" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="u_password_hash" type="varchar(200)">
                <constraints nullable="false"/>
            </column>
            <column name="u_created_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="karadyauran" id="create project_members table">
        <preConditions onFail="CONTINUE" onFailMessage="Table project_members already exists">
            <not>
                <tableExists tableName="project_members"/>
            </not>
        </preConditions>
        <createTable tableName="project_members">
            <column name="pm_project_member_id" type="uuid">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="pm_user_id" type="uuid">
                <constraints nullable="false"/>
<!--                <constraints foreignKeyName="fk_project_members_user_id" references="users(u_user_id)"-->
<!--                             unique="true" nullable="false"/>-->
            </column>
            <column name="pm_role_id" type="uuid">
                <constraints nullable="false"/>
<!--                <constraints foreignKeyName="fk_project_members_user_id" references="roles(r_role_id)"-->
<!--                             unique="true" nullable="false"/>-->
            </column>
            <column name="pm_created_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="pm_updated_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="karadyauran" id="create projects table">
        <preConditions onFail="CONTINUE" onFailMessage="Table projects already exists">
            <not>
                <tableExists tableName="projects"/>
            </not>
        </preConditions>
        <createTable tableName="projects">
            <column name="p_project_id" type="uuid">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="p_owner_id" type="uuid">
                <constraints nullable="false"/>
            </column>
            <column name="p_project_name" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="p_description" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="p_created_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="p_updated_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="karadyauran" id="create roles table">
        <preConditions onFail="CONTINUE" onFailMessage="Table roles already exists">
            <not>
                <tableExists tableName="roles"/>
            </not>
        </preConditions>
        <createTable tableName="roles">
            <column name="r_role_id" type="uuid">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="r_role_name" type="varchar(60)">
                <constraints nullable="false"/>
            </column>
            <column name="r_role_description" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="karadyauran" id="create tasks table">
        <preConditions onFail="CONTINUE" onFailMessage="Table tasks already exists">
            <not>
                <tableExists tableName="task"/>
            </not>
        </preConditions>
        <createTable tableName="tasks">
            <column name="t_task_id" type="uuid">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="t_project_id" type="uuid">
                <constraints nullable="false"/>
            </column>
            <column name="t_assigned_to_id" type="uuid">
                <constraints nullable="false"/>
            </column>
            <column name="t_created_by_id" type="uuid">
                <constraints nullable="false"/>
            </column>
            <column name="t_title" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="t_description" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="t_status" type="varchar(60)">
                <constraints nullable="false"/>
            </column>
            <column name="t_created_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="t_due_to" type="timestamp">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="karadyauran" id="create task_comments table">
        <preConditions onFail="CONTINUE" onFailMessage="Table task_comments already exists">
            <not>
                <tableExists tableName="task_comments"/>
            </not>
        </preConditions>
        <createTable tableName="task_comments">
            <column name="tc_comment_id" type="uuid">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="tc_task_id" type="uuid">
                <constraints nullable="false"/>
            </column>
            <column name="tc_user_id" type="uuid">
                <constraints nullable="false"/>
            </column>
            <column name="tc_comment" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="tc_created_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="karadyauran" id="create task_attachments table">
        <preConditions onFail="CONTINUE" onFailMessage="Table task_attachments already exists">
            <not>
                <tableExists tableName="task_attachments"/>
            </not>
        </preConditions>
        <createTable tableName="task_attachments">
            <column name="ta_attachment_id" type="uuid">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="ta_task_id" type="uuid">
                <constraints nullable="false"/>
            </column>
            <column name="ta_user_id" type="varchar(60)">
                <constraints nullable="false"/>
            </column>
            <column name="ta_attachment_name" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="ta_attachment_type" type="varchar(5)">
                <constraints nullable="false"/>
            </column>
            <column name="ta_attachment_path" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="ta_created_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="karadyauran" id="create notifications table">
        <preConditions onFail="CONTINUE" onFailMessage="Table notifications already exists">
            <not>
                <tableExists tableName="notifications"/>
            </not>
        </preConditions>
        <createTable tableName="notifications">
            <column name="n_notification_id" type="uuid">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="n_sender_id" type="uuid">
                <constraints nullable="false"/>
            </column>
            <column name="n_receiver_id" type="uuid">
                <constraints nullable="false"/>
            </column>
            <column name="n_notification_message" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="n_created_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

</databaseChangeLog>